import{c as j,Q as ie,u as oe,n as ce,d as le,r as i,j as e,B as o,L as M,T as de,X as ue,a as me,b as _,V as xe}from"./main-amE6mPDm.js";import{u as T}from"./useQuery-DdeLzvk4.js";import{u as Q}from"./useMutation-BBcAv7H8.js";import{a as k}from"./api-client-CoYXQ-f4.js";import{P as he}from"./progress-DNbG4PEc.js";import{L as G,S as X}from"./slider-D0SpIcWc.js";import{L as J}from"./loader-circle-D5w-Lebd.js";import{C as fe}from"./circle-alert-EGR15Bm1.js";import{C as Z}from"./clock-DsV4s8UB.js";import{M as pe}from"./message-square-BFr9fZWG.js";import{D as ge}from"./download-Nl6LrYXI.js";import{P as U}from"./play-Bsqp6nLS.js";import"./index-BdQq_4o_.js";import"./index-B2I2svRw.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],O=j("ChevronLeft",je);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]],W=j("CircleCheck",ve);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]],ye=j("Maximize",Ne);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M8 3v3a2 2 0 0 1-2 2H3",key:"hohbtr"}],["path",{d:"M21 8h-3a2 2 0 0 1-2-2V3",key:"5jw1f3"}],["path",{d:"M3 16h3a2 2 0 0 1 2 2v3",key:"198tvr"}],["path",{d:"M16 21v-3a2 2 0 0 1 2-2h3",key:"ph8mxp"}]],we=j("Minimize",be);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1",key:"zuxfzm"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1",key:"1okwgv"}]],Y=j("Pause",ke);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=[["polygon",{points:"19 20 9 12 19 4 19 20",key:"o2sva"}],["line",{x1:"5",x2:"5",y1:"19",y2:"5",key:"1ocqjk"}]],Ce=j("SkipBack",_e);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["polygon",{points:"5 4 15 12 5 20 5 4",key:"16p6eg"}],["line",{x1:"19",x2:"19",y1:"5",y2:"19",key:"futhcm"}]],Le=j("SkipForward",Me);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["path",{d:"M16 9a5 5 0 0 1 0 6",key:"1q6k2b"}],["path",{d:"M19.364 18.364a9 9 0 0 0 0-12.728",key:"ijwkga"}]],ze=j("Volume2",Se);/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["path",{d:"M11 4.702a.705.705 0 0 0-1.203-.498L6.413 7.587A1.4 1.4 0 0 1 5.416 8H3a1 1 0 0 0-1 1v6a1 1 0 0 0 1 1h2.416a1.4 1.4 0 0 1 .997.413l3.383 3.384A.705.705 0 0 0 11 19.298z",key:"uqj9uw"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]],Te=j("VolumeX",Pe);function Ie({src:r,onProgress:c,onComplete:u,initialProgress:g=0,className:h}){const m=i.useRef(null),[l,L]=i.useState(!1),[S,z]=i.useState(0),[v,I]=i.useState(0),[t,q]=i.useState(1),[x,a]=i.useState(!1),[N,y]=i.useState(!1),[R,$]=i.useState(1),[b,w]=i.useState(!0),[E,P]=i.useState(0),[d,f]=i.useState(!0),C=i.useRef();i.useEffect(()=>{const s=m.current;if(!s)return;const n=()=>{f(!1),I(s.duration),g>0&&(s.currentTime=g/100*s.duration)},p=()=>{z(s.currentTime);const V=s.currentTime/s.duration*100;c(s.currentTime,V),V>=90&&u()},K=()=>{if(s.buffered.length>0){const ne=s.buffered.end(s.buffered.length-1)/s.duration*100;P(ne)}},H=()=>{L(!1),u()};return s.addEventListener("loadeddata",n),s.addEventListener("timeupdate",p),s.addEventListener("progress",K),s.addEventListener("ended",H),()=>{s.removeEventListener("loadeddata",n),s.removeEventListener("timeupdate",p),s.removeEventListener("progress",K),s.removeEventListener("ended",H)}},[c,u,g]);const F=()=>{const s=m.current;s&&(l?s.pause():s.play(),L(!l))},D=s=>{const n=m.current;if(!n)return;const p=s[0]/100*v;n.currentTime=p,z(p)},ee=()=>{const s=m.current;s&&(s.muted=!x,a(!x))},se=s=>{const n=m.current;if(!n)return;const p=s[0]/100;n.volume=p,q(p),a(p===0)},A=s=>{const n=m.current;n&&(n.currentTime=Math.max(0,Math.min(n.currentTime+s,v)))},te=s=>{const n=m.current;n&&(n.playbackRate=s,$(s))},ae=()=>{const s=m.current;s&&(N?document.exitFullscreen&&document.exitFullscreen():s.requestFullscreen&&s.requestFullscreen(),y(!N))},B=s=>{const n=Math.floor(s/60),p=Math.floor(s%60);return`${n}:${p.toString().padStart(2,"0")}`},re=()=>{w(!0),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{l&&w(!1)},3e3)};return e.jsxs("div",{className:_("relative group bg-black rounded-lg overflow-hidden",h),onMouseMove:re,onMouseEnter:()=>w(!0),onMouseLeave:()=>l&&w(!1),children:[e.jsx("video",{ref:m,src:r,className:"w-full h-full object-contain",onClick:F,onLoadStart:()=>f(!0),onCanPlay:()=>f(!1)}),d&&e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50",children:e.jsx(J,{className:"h-8 w-8 animate-spin text-white"})}),e.jsxs("div",{className:_("absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-transparent transition-opacity duration-300",b?"opacity-100":"opacity-0"),children:[e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(o,{variant:"ghost",size:"lg",className:"w-16 h-16 rounded-full bg-black/50 text-white hover:bg-black/70",onClick:F,children:l?e.jsx(Y,{className:"h-8 w-8"}):e.jsx(U,{className:"h-8 w-8"})})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 space-y-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-white/20 rounded-full h-1",children:e.jsx("div",{className:"bg-white/40 h-full rounded-full transition-all duration-300",style:{width:`${E}%`}})}),e.jsx(X,{value:[v>0?S/v*100:0],onValueChange:D,max:100,step:.1,className:"relative z-10"})]}),e.jsxs("div",{className:"flex items-center justify-between text-white",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:F,children:l?e.jsx(Y,{className:"h-4 w-4"}):e.jsx(U,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>A(-10),children:e.jsx(Ce,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>A(10),children:e.jsx(Le,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:ee,children:x||t===0?e.jsx(Te,{className:"h-4 w-4"}):e.jsx(ze,{className:"h-4 w-4"})}),e.jsx("div",{className:"w-20",children:e.jsx(X,{value:[x?0:t*100],onValueChange:se,max:100,step:1})})]}),e.jsxs("span",{className:"text-sm font-mono",children:[B(S)," / ",B(v)]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:R,onChange:s=>te(Number(s.target.value)),className:"bg-black/50 text-white text-sm rounded px-2 py-1",children:[e.jsx("option",{value:.5,children:"0.5x"}),e.jsx("option",{value:.75,children:"0.75x"}),e.jsx("option",{value:1,children:"1x"}),e.jsx("option",{value:1.25,children:"1.25x"}),e.jsx("option",{value:1.5,children:"1.5x"}),e.jsx("option",{value:2,children:"2x"})]}),e.jsx(o,{variant:"ghost",size:"sm",children:e.jsx(xe,{className:"h-4 w-4"})}),e.jsx(o,{variant:"ghost",size:"sm",onClick:ae,children:N?e.jsx(we,{className:"h-4 w-4"}):e.jsx(ye,{className:"h-4 w-4"})})]})]})]})]})]})}function qe({lectures:r,currentLectureId:c,courseId:u,onLectureSelect:g}){return e.jsxs("div",{className:"w-80 bg-card border-r flex flex-col h-full",children:[e.jsx("div",{className:"p-4 border-b",children:e.jsxs("h3",{className:"font-semibold text-lg flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Course Content"]})}),e.jsx("div",{className:"flex-1 overflow-y-auto",children:e.jsx("div",{className:"p-2",children:r.map((h,m)=>{const l=h.id===c;return e.jsxs(M,{to:"/learn/$courseId/$lectureId",params:{courseId:u,lectureId:h.id},className:_("flex items-start gap-3 p-3 rounded-lg transition-colors",l?"bg-primary text-primary-foreground":"hover:bg-muted"),onClick:()=>g==null?void 0:g(h.id),children:[e.jsx("div",{className:"flex-shrink-0 mt-0.5",children:e.jsx("div",{className:_("w-4 h-4 rounded-full border-2 text-xs font-bold flex items-center justify-center",l?"border-primary-foreground text-primary-foreground":"border-muted-foreground text-muted-foreground"),children:h.order_number||m+1})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:_("font-medium text-sm line-clamp-2",l?"text-primary-foreground":"text-foreground"),children:h.title}),h.duration_minutes&&e.jsxs("div",{className:_("flex items-center gap-1 mt-1 text-xs",l?"text-primary-foreground/80":"text-muted-foreground"),children:[e.jsx(Z,{className:"h-3 w-3"}),e.jsxs("span",{children:[h.duration_minutes,"m"]})]})]})]},h.id)})})})]})}function Ye(){const{courseId:r,lectureId:c}=ie.useParams(),{token:u,user:g}=oe(),h=ce(),m=le(),[l,L]=i.useState(!0),[S,z]=i.useState(0),{data:v,isLoading:I}=T({queryKey:["course",r],queryFn:async()=>(await k.getCourse(r)).data}),{data:t,isLoading:q}=T({queryKey:["lectures",r],queryFn:async()=>(await k.listLectures(r,{page:1,page_size:200})).data}),{data:x}=T({queryKey:["progress",r,c],queryFn:async()=>{if(!u)return null;try{return(await k.getUserProgress(u,r,c)).data}catch{return null}},enabled:!!g&&!!u}),a=i.useMemo(()=>t==null?void 0:t.lectures.find(d=>d.id===c),[t,c]),N=i.useMemo(()=>(t==null?void 0:t.lectures.findIndex(d=>d.id===c))??-1,[t,c]),{data:y,isLoading:R}=T({queryKey:["video",a==null?void 0:a.video_id],queryFn:async()=>a!=null&&a.video_id?(await k.getVideo(a.video_id)).data:null,enabled:!!(a!=null&&a.video_id)}),$=Q({mutationFn:async({time:d,percentage:f})=>{if(u)return k.updateProgress(u,{course_id:r,lecture_id:c,progress_percentage:f,watch_time_seconds:Math.floor(d),is_completed:f>=90})}}),b=Q({mutationFn:async()=>{if(u)return k.completeLecture(u,{course_id:r,lecture_id:c,watch_time_seconds:Math.floor(S)})},onSuccess:()=>{m.invalidateQueries({queryKey:["progress"]})}}),w=(d,f)=>{z(d),$.mutate({time:d,percentage:f})},E=()=>{b.mutate()},P=d=>{if(!(t!=null&&t.lectures))return;const f=d==="next"?N+1:N-1;if(f>=0&&f<t.lectures.length){const C=t.lectures[f];h({to:"/learn/$courseId/$lectureId",params:{courseId:r,lectureId:C.id}})}};return I||q?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(J,{className:"h-6 w-6 animate-spin text-primary"}),e.jsx("span",{className:"text-muted-foreground",children:"Loading course content..."})]})}):!v||!a?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center",children:[e.jsx(fe,{className:"h-12 w-12 text-destructive mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Content not found"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"The course or lecture you're looking for doesn't exist or has been removed."}),e.jsx(o,{asChild:!0,children:e.jsxs(M,{to:"/courses",children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Back to Courses"]})})]}):e.jsxs("div",{className:"min-h-screen bg-background flex",children:[l&&e.jsx(qe,{lectures:(t==null?void 0:t.lectures)||[],currentLectureId:c,courseId:r}),e.jsxs("div",{className:"flex-1 flex flex-col",children:[e.jsx("div",{className:"bg-card border-b px-4 py-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(o,{variant:"ghost",size:"sm",onClick:()=>L(!l),children:e.jsx(G,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(M,{to:"/courses/$courseId",params:{courseId:r},className:"hover:text-foreground transition-colors",children:v.title}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-foreground font-medium",children:a.title})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>P("prev"),disabled:N<=0,children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>P("next"),disabled:N>=((t==null?void 0:t.lectures.length)||0)-1,children:e.jsx(de,{className:"h-4 w-4"})}),e.jsx(o,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(M,{to:"/courses/$courseId",params:{courseId:r},children:e.jsx(ue,{className:"h-4 w-4"})})})]})]})}),e.jsx("div",{className:"flex-1 p-4",children:e.jsxs("div",{className:"max-w-5xl mx-auto space-y-6",children:[y!=null&&y.stream_url?e.jsx(Ie,{src:y.stream_url,onProgress:w,onComplete:E,initialProgress:(x==null?void 0:x.progress_percentage)||0,className:"aspect-video w-full"}):e.jsx("div",{className:"aspect-video w-full bg-muted rounded-lg flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(me,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Video Available"}),e.jsx("p",{className:"text-muted-foreground",children:"This lecture doesn't have a video yet."})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold font-academic mb-2",children:a.title}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-4",children:[a.duration_minutes&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Z,{className:"h-4 w-4"}),e.jsxs("span",{children:[a.duration_minutes," minutes"]})]}),x&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(W,{className:"h-4 w-4 text-success"}),e.jsxs("span",{children:[Math.round(x.progress_percentage),"% complete"]})]})]}),x&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Your Progress"}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[Math.round(x.progress_percentage),"%"]})]}),e.jsx(he,{value:x.progress_percentage,className:"h-2"})]})]}),a.description&&e.jsxs("div",{className:"academic-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-3",children:"About this lecture"}),e.jsx("p",{className:"text-muted-foreground leading-relaxed",children:a.description})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(o,{onClick:()=>b.mutate(),disabled:b.isPending,className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),b.isPending?"Marking Complete...":"Mark Complete"]}),e.jsx(o,{variant:"outline",asChild:!0,children:e.jsxs(M,{to:"/forum",search:{course_id:r},children:[e.jsx(pe,{className:"h-4 w-4 mr-2"}),"Discuss"]})}),y&&e.jsxs(o,{variant:"outline",children:[e.jsx(ge,{className:"h-4 w-4 mr-2"}),"Resources"]})]})]})]})})]})]})}export{Ye as component};
