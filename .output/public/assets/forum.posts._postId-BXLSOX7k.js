import{c as q,Z as M,u as z,r as d,j as e,B as x,b as c,U as C,f as A}from"./main-amE6mPDm.js";import{T as _}from"./textarea-DpBpWtX7.js";import{f as h,P as $,E as F,T as H}from"./forum-1dxvdMGf.js";import{M as j}from"./message-square-BFr9fZWG.js";import{A as J}from"./arrow-left-BeZzhq3e.js";import{T as P,a as T}from"./thumbs-up-gXuOjcks.js";import{L as Y}from"./lock-DIxZ9tmy.js";import{C as g,a as E}from"./circle-check-big-DaPFtRnM.js";import{S as Z}from"./send-mopWIPjK.js";/**
 * @license lucide-react v0.476.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]],K=q("Reply",G);function ne(){const{postId:N}=M.useParams(),{user:i}=z(),[t,m]=d.useState(null),[L,v]=d.useState(!0),[u,b]=d.useState(""),[f,w]=d.useState(!1),[D,y]=d.useState(null);d.useEffect(()=>{I()},[N]);const I=async()=>{v(!0);try{const s=await h.getPost(N);s&&m(s)}catch(s){console.error("Error loading post:",s)}finally{v(!1)}},R=async s=>{if(t)try{await h.votePost(t.id,s),m(a=>{if(!a)return null;let r=a.votes,o=s;return a.userVote===s?(o=null,r=a.userVote==="up"?a.votes-1:a.votes+1):a.userVote?r=a.userVote==="up"?a.votes-2:a.votes+2:r=s==="up"?a.votes+1:a.votes-1,{...a,votes:r,userVote:o}})}catch(a){console.error("Error voting on post:",a)}},k=async(s,a)=>{if(t)try{await h.voteReply(s,a),m(r=>{if(!r)return null;const o=l=>l.map(n=>{if(n.id===s){let p=n.votes,S=a;return n.userVote===a?(S=null,p=n.userVote==="up"?n.votes-1:n.votes+1):n.userVote?p=n.userVote==="up"?n.votes-2:n.votes+2:p=a==="up"?n.votes+1:n.votes-1,{...n,votes:p,userVote:S}}return n.replies?{...n,replies:o(n.replies)}:n});return{...r,replies:o(r.replies)}})}catch(r){console.error("Error voting on reply:",r)}},U=async s=>{if(s.preventDefault(),!(!u.trim()||!t||!i)){w(!0);try{const a={content:u.trim(),postId:t.id,parentId:D||void 0},r=await h.createReply(a);m(o=>o?{...o,replies:[...o.replies,r]}:null),b(""),y(null)}catch(a){console.error("Error submitting reply:",a)}finally{w(!1)}}},B=async s=>{try{await h.acceptReply(s),m(a=>{if(!a)return null;const r=o=>o.map(l=>({...l,isAccepted:l.id===s,replies:l.replies?r(l.replies):void 0}));return{...a,isSolved:!0,replies:r(a.replies)}})}catch(a){console.error("Error accepting reply:",a)}},V=({reply:s,depth:a=0})=>e.jsx("div",{className:c("border-l-2 border-muted",a>0&&"ml-6"),children:e.jsxs("div",{className:"academic-card p-4 ml-4",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 min-w-[30px]",children:[e.jsx("button",{onClick:()=>k(s.id,"up"),className:"p-1 rounded hover:bg-muted transition-colors",children:e.jsx(P,{className:c("h-3 w-3",s.userVote==="up"?"text-primary fill-current":"text-muted-foreground")})}),e.jsx("span",{className:c("text-xs font-medium",s.votes>0?"text-success":s.votes<0?"text-destructive":"text-muted-foreground"),children:s.votes}),e.jsx("button",{onClick:()=>k(s.id,"down"),className:"p-1 rounded hover:bg-muted transition-colors",children:e.jsx(T,{className:c("h-3 w-3",s.userVote==="down"?"text-destructive fill-current":"text-muted-foreground")})})]}),e.jsxs("div",{className:"flex-1",children:[s.isAccepted&&e.jsxs("div",{className:"mb-2 flex items-center gap-2 text-success",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Accepted Answer"})]}),e.jsx("div",{className:"prose prose-sm max-w-none mb-3",children:e.jsx("p",{children:s.content})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[s.author.avatar?e.jsx("img",{src:s.author.avatar,alt:s.author.username,className:"h-4 w-4 rounded-full"}):e.jsx(C,{className:"h-3 w-3 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:s.author.username}),e.jsx("span",{className:c("px-1.5 py-0.5 rounded text-xs font-medium",s.author.role==="instructor"&&"bg-primary/10 text-primary",s.author.role==="admin"&&"bg-destructive/10 text-destructive",s.author.role==="student"&&"bg-muted text-muted-foreground"),children:s.author.role}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(E,{className:"h-3 w-3"}),e.jsx("span",{children:A(new Date(s.createdAt))})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[i&&(t==null?void 0:t.author.id)===i.id&&!s.isAccepted&&e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>B(s.id),children:[e.jsx(g,{className:"h-3 w-3 mr-1"}),"Accept"]}),e.jsxs(x,{size:"sm",variant:"ghost",onClick:()=>y(s.id),children:[e.jsx(K,{className:"h-3 w-3 mr-1"}),"Reply"]})]})]})]})]}),s.replies&&s.replies.map(r=>e.jsx(V,{reply:r,depth:a+1},r.id))]})});return L?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-4",children:[e.jsx("div",{className:"h-8 bg-muted rounded w-1/4"}),e.jsx("div",{className:"h-4 bg-muted rounded w-3/4"}),e.jsx("div",{className:"h-64 bg-muted rounded"})]})})}):t?e.jsx("div",{className:"min-h-screen bg-background",children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(x,{variant:"ghost",className:"gap-2",onClick:()=>window.history.back(),children:[e.jsx(J,{className:"h-4 w-4"}),"Back to Forum"]})}),e.jsx("div",{className:"academic-card p-6 mb-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("div",{className:"flex flex-col items-center gap-2 min-w-[60px]",children:[e.jsx("button",{onClick:()=>R("up"),className:"p-2 rounded hover:bg-muted transition-colors",disabled:!i,children:e.jsx(P,{className:c("h-6 w-6",t.userVote==="up"?"text-primary fill-current":"text-muted-foreground")})}),e.jsx("span",{className:c("text-xl font-bold",t.votes>0?"text-success":t.votes<0?"text-destructive":"text-muted-foreground"),children:t.votes}),e.jsx("button",{onClick:()=>R("down"),className:"p-2 rounded hover:bg-muted transition-colors",disabled:!i,children:e.jsx(T,{className:c("h-6 w-6",t.userVote==="down"?"text-destructive fill-current":"text-muted-foreground")})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.isPinned&&e.jsx($,{className:"h-5 w-5 text-warning"}),t.isLocked&&e.jsx(Y,{className:"h-5 w-5 text-muted-foreground"}),t.isSolved&&e.jsx(g,{className:"h-5 w-5 text-success"}),e.jsx("span",{className:"px-3 py-1 rounded-full text-sm font-medium",style:{backgroundColor:`var(--color-${t.category.color}-100)`,color:`var(--color-${t.category.color}-700)`},children:t.category.name})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.views," views"]})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(j,{className:"h-4 w-4"}),e.jsxs("span",{children:[t.replies.length," replies"]})]})]})]}),e.jsx("h1",{className:"text-2xl font-bold text-foreground mb-4",children:t.title}),e.jsx("div",{className:"prose prose-lg max-w-none mb-6",children:e.jsx("p",{children:t.content})}),t.tags.length>0&&e.jsxs("div",{className:"flex items-center gap-2 mb-4 flex-wrap",children:[e.jsx(H,{className:"h-4 w-4 text-muted-foreground"}),t.tags.map(s=>e.jsx("span",{className:"px-2 py-1 bg-muted text-muted-foreground rounded text-sm",children:s},s))]}),e.jsx("div",{className:"flex items-center justify-between pt-4 border-t",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.author.avatar?e.jsx("img",{src:t.author.avatar,alt:t.author.username,className:"h-8 w-8 rounded-full"}):e.jsx(C,{className:"h-6 w-6 text-muted-foreground"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:t.author.username}),e.jsx("span",{className:c("px-2 py-1 rounded text-xs font-medium",t.author.role==="instructor"&&"bg-primary/10 text-primary",t.author.role==="admin"&&"bg-destructive/10 text-destructive",t.author.role==="student"&&"bg-muted text-muted-foreground"),children:t.author.role})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground",children:[e.jsx(E,{className:"h-3 w-3"}),e.jsx("span",{children:A(new Date(t.createdAt))})]})]})]})})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold",children:[t.replies.length," ",t.replies.length===1?"Reply":"Replies"]})}),t.replies.map(s=>e.jsx(V,{reply:s},s.id)),i&&!t.isLocked&&e.jsxs("div",{className:"academic-card p-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Your Reply"}),e.jsxs("form",{onSubmit:U,className:"space-y-4",children:[e.jsx(_,{placeholder:"Share your thoughts, answer the question, or contribute to the discussion...",value:u,onChange:s=>b(s.target.value),rows:6,maxLength:5e3,required:!0}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-xs text-muted-foreground",children:[u.length,"/5000 characters"]}),e.jsxs(x,{type:"submit",disabled:f||!u.trim(),children:[f?e.jsx("div",{className:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent mr-2"}):e.jsx(Z,{className:"h-4 w-4 mr-2"}),f?"Posting...":"Post Reply"]})]})]})]}),!i&&e.jsxs("div",{className:"academic-card p-6 text-center",children:[e.jsx(j,{className:"h-8 w-8 text-muted-foreground mx-auto mb-3"}),e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"Join the Discussion"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Log in to reply to this post and engage with the community."}),e.jsx(x,{children:"Sign In"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-background",children:e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"academic-card p-8 text-center",children:[e.jsx(j,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Post not found"}),e.jsx("p",{className:"text-muted-foreground",children:"The post you're looking for doesn't exist or has been removed."})]})})})}export{ne as component};
