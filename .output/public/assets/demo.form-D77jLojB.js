import{a2 as k,a3 as ye,a4 as H,r as C,j as y,a5 as $,I as Se,B as Ve}from"./main-amE6mPDm.js";import{T as be}from"./textarea-DpBpWtX7.js";import{S as pe,a as Ae,b as we,c as Ee,e as Le,f as Ce,d as Ie}from"./select-Nm150RRW.js";import{L as ge}from"./label-2d2k_XBO.js";function W(r,a){return typeof r=="function"?r(a):r}function O(r,a){return Q(a).reduce((e,t)=>{if(e===null)return null;if(typeof e<"u")return e[t]},r)}function _(r,a,i){const e=Q(a);function t(s){if(!e.length)return W(i,s);const n=e.shift();if(typeof n=="string"||typeof n=="number"&&!Array.isArray(s))return typeof s=="object"?(s===null&&(s={}),{...s,[n]:t(s[n])}):{[n]:t()};if(Array.isArray(s)&&typeof n=="number"){const o=s.slice(0,n);return[...o.length?o:new Array(n),t(s[n]),...s.slice(n+1)]}return[...new Array(n),t()]}return t(r)}function xe(r,a){const i=Q(a);function e(t){if(!t)return;if(i.length===1){const n=i[0];if(Array.isArray(t)&&typeof n=="number")return t.filter((d,h)=>h!==n);const{[n]:o,...u}=t;return u}const s=i.shift();if(typeof s=="string"&&typeof t=="object")return{...t,[s]:e(t[s])};if(typeof s=="number"&&Array.isArray(t)){if(s>=t.length)return t;const n=t.slice(0,s);return[...n.length?n:new Array(s),e(t[s]),...t.slice(s+1)]}throw new Error("It seems we have created an infinite loop in deleteBy. ")}return e(r)}const ke=/^(\d+)$/gm,Oe=/\.(\d+)(?=\.)/gm,Te=/^(\d+)\./gm,je=/\.(\d+$)/gm,De=/\.{2,}/gm,Z="__int__",K=`${Z}$1`;function Q(r){if(Array.isArray(r))return[...r];if(typeof r!="string")throw new Error("Path must be a string.");return r.replace(/(^\[)|]/gm,"").replace(/\[/g,".").replace(ke,K).replace(Oe,`.${K}.`).replace(Te,`${K}.`).replace(je,`.${K}`).replace(De,".").split(".").map(a=>{if(a.startsWith(Z)){const i=a.substring(Z.length),e=parseInt(i,10);return String(e)===i?e:i}return a})}function ue(r,a){return r.length===0?a:a.length===0?r:a.startsWith("[")||a.startsWith(".")?r+a:`${r}.${a}`}function Be(r){return!(Array.isArray(r)&&r.length===0)}function ee(r,a){const i=e=>e.validators.filter(Boolean).map(t=>({cause:t.cause,validate:t.fn}));return a.validationLogic({form:a.form,validators:a.validators,event:{type:r,async:!1},runValidation:i})}function te(r,a){const{asyncDebounceMs:i}=a,{onBlurAsyncDebounceMs:e,onChangeAsyncDebounceMs:t,onDynamicAsyncDebounceMs:s}=a.validators||{},n=i??0,o=u=>u.validators.filter(Boolean).map(d=>{const h=(d==null?void 0:d.cause)||r;let c=n;switch(h){case"change":c=t??n;break;case"blur":c=e??n;break;case"dynamic":c=s??n;break;case"submit":c=0;break}return r==="submit"&&(c=0),{cause:h,validate:d.fn,debounceMs:c}});return a.validationLogic({form:a.form,validators:a.validators,event:{type:r,async:!0},runValidation:o})}const ie=r=>!!r&&typeof r=="object"&&"fields"in r;function j(r,a){if(Object.is(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;if(r instanceof Date&&a instanceof Date)return r.getTime()===a.getTime();if(r instanceof Map&&a instanceof Map){if(r.size!==a.size)return!1;for(const[t,s]of r)if(!a.has(t)||!Object.is(s,a.get(t)))return!1;return!0}if(r instanceof Set&&a instanceof Set){if(r.size!==a.size)return!1;for(const t of r)if(!a.has(t))return!1;return!0}const i=Object.keys(r),e=Object.keys(a);if(i.length!==e.length)return!1;for(const t of i)if(!e.includes(t)||!j(r[t],a[t]))return!1;return!0}const de=({newFormValidatorError:r,isPreviousErrorFromFormValidator:a,previousErrorValue:i})=>r?{newErrorValue:r,newSource:"form"}:a?{newErrorValue:void 0,newSource:void 0}:i?{newErrorValue:i,newSource:"field"}:{newErrorValue:void 0,newSource:void 0},ce=({formLevelError:r,fieldLevelError:a})=>a?{newErrorValue:a,newSource:"field"}:r?{newErrorValue:r,newSource:"form"}:{newErrorValue:void 0,newSource:void 0};function L(r,a){return r==null?a:{...r,...a}}const D=r=>{if(!r.validators)return r.runValidation({validators:[],form:r.form});const a=r.event.async,i=a?void 0:{fn:r.validators.onMount,cause:"mount"},e={fn:a?r.validators.onChangeAsync:r.validators.onChange,cause:"change"},t={fn:a?r.validators.onBlurAsync:r.validators.onBlur,cause:"blur"},s={fn:a?r.validators.onSubmitAsync:r.validators.onSubmit,cause:"submit"},n=a?void 0:{fn:()=>{},cause:"server"};switch(r.event.type){case"mount":return r.runValidation({validators:[i],form:r.form});case"submit":return r.runValidation({validators:[e,t,s,n],form:r.form});case"server":return r.runValidation({validators:[],form:r.form});case"blur":return r.runValidation({validators:[t,n],form:r.form});case"change":return r.runValidation({validators:[e,n],form:r.form});default:throw new Error(`Unknown validation event type: ${r.event.type}`)}};function $e(r){const a=new Map;for(const i of r){const e=[...i.path??[]].map(t=>{const s=typeof t=="object"?t.key:t;return typeof s=="number"?`[${s}]`:s}).join(".").replace(/\.\[/g,"[");a.set(e,(a.get(e)??[]).concat(i))}return Object.fromEntries(a)}const he=r=>{const a=$e(r);return{form:a,fields:a}},B={validate({value:r,validationSource:a},i){const e=i["~standard"].validate(r);if(e instanceof Promise)throw new Error("async function passed to sync validator");if(e.issues)return a==="field"?e.issues:he(e.issues)},async validateAsync({value:r,validationSource:a},i){const e=await i["~standard"].validate(r);if(e.issues)return a==="field"?e.issues:he(e.issues)}},Me=r=>!!r&&"~standard"in r,q={isValidating:!1,isTouched:!1,isBlurred:!1,isDirty:!1,isPristine:!0,isValid:!0,isDefaultValue:!0,errors:[],errorMap:{},errorSourceMap:{}};function U(r){function a(c,l,f,m){const v=e(c,l,f,m);({insert:()=>o(v,c,l),remove:()=>u(v),swap:()=>m!==void 0&&h(v,c,l,m),move:()=>m!==void 0&&d(v,c,l,m)})[f]()}function i(c,l){return`${c}[${l}]`}function e(c,l,f,m){const v=[i(c,l)];if(f==="swap")v.push(i(c,m));else if(f==="move"){const[g,M]=[Math.min(l,m),Math.max(l,m)];for(let F=g;F<=M;F++)v.push(i(c,F))}else{const g=r.getFieldValue(c),M=Array.isArray(g)?g.length:0;for(let F=l+1;F<M;F++)v.push(i(c,F))}return Object.keys(r.fieldInfo).filter(g=>v.some(M=>g.startsWith(M)))}function t(c,l){return c.replace(/\[(\d+)\]/,(f,m)=>{const v=parseInt(m,10);return`[${l==="up"?v+1:Math.max(0,v-1)}]`})}function s(c,l){(l==="up"?c:[...c].reverse()).forEach(m=>{const v=t(m.toString(),l),g=r.getFieldMeta(v);g?r.setFieldMeta(m,g):r.setFieldMeta(m,n())})}const n=()=>q,o=(c,l,f)=>{s(c,"down"),c.forEach(m=>{m.toString().startsWith(i(l,f))&&r.setFieldMeta(m,n())})},u=c=>{s(c,"up")},d=(c,l,f,m)=>{const v=new Map(Object.keys(r.fieldInfo).filter(g=>g.startsWith(i(l,f))).map(g=>[g,r.getFieldMeta(g)]));s(c,f<m?"up":"down"),Object.keys(r.fieldInfo).filter(g=>g.startsWith(i(l,m))).forEach(g=>{const M=g.replace(i(l,m),i(l,f)),F=v.get(M);F&&r.setFieldMeta(g,F)})},h=(c,l,f,m)=>{c.forEach(v=>{if(!v.toString().startsWith(i(l,f)))return;const g=v.toString().replace(i(l,f),i(l,m)),[M,F]=[r.getFieldMeta(v),r.getFieldMeta(g)];M&&r.setFieldMeta(g,M),F&&r.setFieldMeta(v,F)})};return{handleArrayFieldMetaShift:a}}function Y(r){return{values:r.values??{},errorMap:r.errorMap??{},fieldMetaBase:r.fieldMetaBase??{},isSubmitted:r.isSubmitted??!1,isSubmitting:r.isSubmitting??!1,isValidating:r.isValidating??!1,submissionAttempts:r.submissionAttempts??0,isSubmitSuccessful:r.isSubmitSuccessful??!1,validationMetaMap:r.validationMetaMap??{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}}}class Pe{constructor(a){var i;this.options={},this.fieldInfo={},this.prevTransformArray=[],this.mount=()=>{var o,u;const e=this.fieldMetaDerived.mount(),t=this.store.mount(),s=()=>{e(),t()};(u=(o=this.options.listeners)==null?void 0:o.onMount)==null||u.call(o,{formApi:this});const{onMount:n}=this.options.validators||{};return n&&this.validateSync("mount"),s},this.update=e=>{var u,d;if(!e)return;const t=this.options;this.options=e;const s=!!((d=(u=e.transform)==null?void 0:u.deps)!=null&&d.some((h,c)=>h!==this.prevTransformArray[c])),n=e.defaultValues&&!j(e.defaultValues,t.defaultValues)&&!this.state.isTouched,o=!j(e.defaultState,t.defaultState)&&!this.state.isTouched;!n&&!o&&!s||k(()=>{this.baseStore.setState(()=>Y(Object.assign({},this.state,o?e.defaultState:{},n?{values:e.defaultValues}:{},s?{_force_re_eval:!this.state._force_re_eval}:{})))})},this.reset=(e,t)=>{const{fieldMeta:s}=this.state,n=this.resetFieldMeta(s);e&&!(t!=null&&t.keepDefaultValues)&&(this.options={...this.options,defaultValues:e}),this.baseStore.setState(()=>{var o;return Y({...this.options.defaultState,values:e??this.options.defaultValues??((o=this.options.defaultState)==null?void 0:o.values),fieldMetaBase:n})})},this.validateAllFields=async e=>{const t=[];return k(()=>{Object.values(this.fieldInfo).forEach(n=>{if(!n.instance)return;const o=n.instance;t.push(Promise.resolve().then(()=>o.validate(e,{skipFormValidation:!0}))),n.instance.state.meta.isTouched||n.instance.setMeta(u=>({...u,isTouched:!0}))})}),(await Promise.all(t)).flat()},this.validateArrayFieldsStartingFrom=async(e,t,s)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null,u=[`${e}[${t}]`];for(let l=t+1;l<=(o??0);l++)u.push(`${e}[${l}]`);const d=Object.keys(this.fieldInfo).filter(l=>u.some(f=>l.startsWith(f))),h=[];return k(()=>{d.forEach(l=>{h.push(Promise.resolve().then(()=>this.validateField(l,s)))})}),(await Promise.all(h)).flat()},this.validateField=(e,t)=>{var n;const s=(n=this.fieldInfo[e])==null?void 0:n.instance;return s?(s.state.meta.isTouched||s.setMeta(o=>({...o,isTouched:!0})),s.validate(t)):[]},this.validateSync=e=>{const t=ee(e,{...this.options,form:this,validationLogic:this.options.validationLogic||D});let s=!1;const n={};return k(()=>{var d,h,c;for(const l of t){if(!l.validate)continue;const f=this.runValidator({validate:l.validate,value:{value:this.state.values,formApi:this,validationSource:"form"},type:"validate"}),{formError:m,fieldErrors:v}=G(f),g=N(l.cause);for(const M of Object.keys(this.state.fieldMeta)){const F=this.getFieldMeta(M);if(!F)continue;const{errorMap:S,errorSourceMap:b}=F,p=v==null?void 0:v[M],{newErrorValue:w,newSource:E}=de({newFormValidatorError:p,isPreviousErrorFromFormValidator:(b==null?void 0:b[g])==="form",previousErrorValue:S==null?void 0:S[g]});E==="form"&&(n[M]={...n[M],[g]:p}),(S==null?void 0:S[g])!==w&&this.setFieldMeta(M,I=>({...I,errorMap:{...I.errorMap,[g]:w},errorSourceMap:{...I.errorSourceMap,[g]:E}}))}((d=this.state.errorMap)==null?void 0:d[g])!==m&&this.baseStore.setState(M=>({...M,errorMap:{...M.errorMap,[g]:m}})),(m||v)&&(s=!0)}const o=N("submit");(h=this.state.errorMap)!=null&&h[o]&&e!=="submit"&&!s&&this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[o]:void 0}}));const u=N("server");(c=this.state.errorMap)!=null&&c[u]&&e!=="server"&&!s&&this.baseStore.setState(l=>({...l,errorMap:{...l.errorMap,[u]:void 0}}))}),{hasErrored:s,fieldsErrorMap:n}},this.validateAsync=async e=>{const t=te(e,{...this.options,form:this,validationLogic:this.options.validationLogic||D});this.state.isFormValidating||this.baseStore.setState(d=>({...d,isFormValidating:!0}));const s=[];let n;for(const d of t){if(!d.validate)continue;const h=N(d.cause),c=this.state.validationMetaMap[h];c==null||c.lastAbortController.abort();const l=new AbortController;this.state.validationMetaMap[h]={lastAbortController:l},s.push(new Promise(async f=>{let m;try{m=await new Promise((F,S)=>{setTimeout(async()=>{if(l.signal.aborted)return F(void 0);try{F(await this.runValidator({validate:d.validate,value:{value:this.state.values,formApi:this,validationSource:"form",signal:l.signal},type:"validateAsync"}))}catch(b){S(b)}},d.debounceMs)})}catch(F){m=F}const{formError:v,fieldErrors:g}=G(m);g&&(n=n?{...n,...g}:g);const M=N(d.cause);for(const F of Object.keys(this.state.fieldMeta)){const S=this.getFieldMeta(F);if(!S)continue;const{errorMap:b,errorSourceMap:p}=S,w=n==null?void 0:n[F],{newErrorValue:E,newSource:I}=de({newFormValidatorError:w,isPreviousErrorFromFormValidator:(p==null?void 0:p[M])==="form",previousErrorValue:b==null?void 0:b[M]});(b==null?void 0:b[M])!==E&&this.setFieldMeta(F,A=>({...A,errorMap:{...A.errorMap,[M]:E},errorSourceMap:{...A.errorSourceMap,[M]:I}}))}this.baseStore.setState(F=>({...F,errorMap:{...F.errorMap,[M]:v}})),f(n?{fieldErrors:n,errorMapKey:M}:void 0)}))}let o=[];const u={};if(s.length){o=await Promise.all(s);for(const d of o)if(d!=null&&d.fieldErrors){const{errorMapKey:h}=d;for(const[c,l]of Object.entries(d.fieldErrors)){const m={...u[c]||{},[h]:l};u[c]=m}}}return this.baseStore.setState(d=>({...d,isFormValidating:!1})),u},this.validate=e=>{const{hasErrored:t,fieldsErrorMap:s}=this.validateSync(e);return t&&!this.options.asyncAlways?s:this.validateAsync(e)},this.getFieldValue=e=>O(this.state.values,e),this.getFieldMeta=e=>this.state.fieldMeta[e],this.getFieldInfo=e=>{var t;return(t=this.fieldInfo)[e]||(t[e]={instance:null,validationMetaMap:{onChange:void 0,onBlur:void 0,onSubmit:void 0,onMount:void 0,onServer:void 0,onDynamic:void 0}})},this.setFieldMeta=(e,t)=>{this.baseStore.setState(s=>({...s,fieldMetaBase:{...s.fieldMetaBase,[e]:W(t,s.fieldMetaBase[e])}}))},this.resetFieldMeta=e=>Object.keys(e).reduce((t,s)=>{const n=s;return t[n]=q,t},{}),this.setFieldValue=(e,t,s)=>{var d;const n=(s==null?void 0:s.dontUpdateMeta)??!1,o=(s==null?void 0:s.dontRunListeners)??!1,u=(s==null?void 0:s.dontValidate)??!1;k(()=>{n||this.setFieldMeta(e,h=>({...h,isTouched:!0,isDirty:!0,errorMap:{...h==null?void 0:h.errorMap,onMount:void 0}})),this.baseStore.setState(h=>({...h,values:_(h.values,e,t)}))}),o||(d=this.getFieldInfo(e).instance)==null||d.triggerOnChangeListener(),u||this.validateField(e,"change")},this.deleteField=e=>{const s=[...Object.keys(this.fieldInfo).filter(n=>{const o=e.toString();return n!==o&&n.startsWith(o)}),e];this.baseStore.setState(n=>{const o={...n};return s.forEach(u=>{o.values=xe(o.values,u),delete this.fieldInfo[u],delete o.fieldMetaBase[u]}),o})},this.pushFieldValue=(e,t,s)=>{this.setFieldValue(e,n=>[...Array.isArray(n)?n:[],t],s)},this.insertFieldValue=async(e,t,s,n)=>{this.setFieldValue(e,o=>[...o.slice(0,t),s,...o.slice(t)],L(n,{dontValidate:!0})),await this.validateField(e,"change"),U(this).handleArrayFieldMetaShift(e,t,"insert"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.replaceFieldValue=async(e,t,s,n)=>{this.setFieldValue(e,o=>o.map((u,d)=>d===t?s:u),L(n,{dontValidate:!0})),await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.removeFieldValue=async(e,t,s)=>{const n=this.getFieldValue(e),o=Array.isArray(n)?Math.max(n.length-1,0):null;if(this.setFieldValue(e,u=>u.filter((d,h)=>h!==t),L(s,{dontValidate:!0})),U(this).handleArrayFieldMetaShift(e,t,"remove"),o!==null){const u=`${e}[${o}]`;this.deleteField(u)}await this.validateField(e,"change"),await this.validateArrayFieldsStartingFrom(e,t,"change")},this.swapFieldValues=(e,t,s,n)=>{this.setFieldValue(e,o=>{const u=o[t],d=o[s];return _(_(o,`${t}`,d),`${s}`,u)},L(n,{dontValidate:!0})),U(this).handleArrayFieldMetaShift(e,t,"swap",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.moveFieldValues=(e,t,s,n)=>{this.setFieldValue(e,o=>{const u=[...o];return u.splice(s,0,u.splice(t,1)[0]),u},L(n,{dontValidate:!0})),U(this).handleArrayFieldMetaShift(e,t,"move",s),this.validateField(e,"change"),this.validateField(`${e}[${t}]`,"change"),this.validateField(`${e}[${s}]`,"change")},this.clearFieldValues=(e,t)=>{const s=this.getFieldValue(e),n=Array.isArray(s)?Math.max(s.length-1,0):null;if(this.setFieldValue(e,[],L(t,{dontValidate:!0})),n!==null)for(let o=0;o<=n;o++){const u=`${e}[${o}]`;this.deleteField(u)}this.validateField(e,"change")},this.resetField=e=>{this.baseStore.setState(t=>({...t,fieldMetaBase:{...t.fieldMetaBase,[e]:q},values:this.options.defaultValues?_(t.values,e,O(this.options.defaultValues,e)):t.values}))},this.getAllErrors=()=>({form:{errors:this.state.errors,errorMap:this.state.errorMap},fields:Object.entries(this.state.fieldMeta).reduce((e,[t,s])=>(Object.keys(s).length&&s.errors.length&&(e[t]={errors:s.errors,errorMap:s.errorMap}),e),{})}),this.parseValuesWithSchema=e=>B.validate({value:this.state.values,validationSource:"form"},e),this.parseValuesWithSchemaAsync=e=>B.validateAsync({value:this.state.values,validationSource:"form"},e),this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.baseStore=new ye(Y({...a==null?void 0:a.defaultState,values:(a==null?void 0:a.defaultValues)??((i=a==null?void 0:a.defaultState)==null?void 0:i.values)})),this.fieldMetaDerived=new H({deps:[this.baseStore],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{var c,l,f;const n=s,o=e==null?void 0:e[0],u=t[0];let d=0;const h={};for(const m of Object.keys(u.fieldMetaBase)){const v=u.fieldMetaBase[m],g=o==null?void 0:o.fieldMetaBase[m],M=n==null?void 0:n[m],F=O(u.values,m);let S=M==null?void 0:M.errors;if(!g||v.errorMap!==g.errorMap){S=Object.values(v.errorMap??{}).filter(I=>I!==void 0);const E=(c=this.getFieldInfo(m))==null?void 0:c.instance;E&&!E.options.disableErrorFlat&&(S=S==null?void 0:S.flat(1))}const b=!Be(S??[]),p=!v.isDirty,w=j(F,O(this.options.defaultValues,m))||j(F,(f=(l=this.getFieldInfo(m))==null?void 0:l.instance)==null?void 0:f.options.defaultValue);if(M&&M.isPristine===p&&M.isValid===b&&M.isDefaultValue===w&&M.errors===S&&v===g){h[m]=M,d++;continue}h[m]={...v,errors:S,isPristine:p,isValid:b,isDefaultValue:w}}return Object.keys(u.fieldMetaBase).length&&n&&d===Object.keys(u.fieldMetaBase).length?n:h}}),this.store=new H({deps:[this.baseStore,this.fieldMetaDerived],fn:({prevDepVals:e,currDepVals:t,prevVal:s})=>{var ae,ne,oe,le;const n=s,o=e==null?void 0:e[0],u=t[0],d=t[1],h=Object.values(d).filter(Boolean),c=h.some(V=>V.isValidating),l=h.every(V=>V.isValid),f=h.some(V=>V.isTouched),m=h.some(V=>V.isBlurred),v=h.every(V=>V.isDefaultValue),g=f&&((ae=u.errorMap)==null?void 0:ae.onMount),M=h.some(V=>V.isDirty),F=!M,S=!!((ne=u.errorMap)!=null&&ne.onMount||h.some(V=>{var x;return(x=V==null?void 0:V.errorMap)==null?void 0:x.onMount})),b=!!c;let p=(n==null?void 0:n.errors)??[];(!o||u.errorMap!==o.errorMap)&&(p=Object.values(u.errorMap).reduce((V,x)=>x===void 0?V:x&&ie(x)?(V.push(x.form),V):(V.push(x),V),[]));const w=p.length===0,E=l&&w,I=this.options.canSubmitWhenInvalid??!1,A=u.submissionAttempts===0&&!f&&!S||!b&&!u.isSubmitting&&E||I;let T=u.errorMap;if(g&&(p=p.filter(V=>V!==u.errorMap.onMount),T=Object.assign(T,{onMount:void 0})),n&&o&&n.errorMap===T&&n.fieldMeta===this.fieldMetaDerived.state&&n.errors===p&&n.isFieldsValidating===c&&n.isFieldsValid===l&&n.isFormValid===w&&n.isValid===E&&n.canSubmit===A&&n.isTouched===f&&n.isBlurred===m&&n.isPristine===F&&n.isDefaultValue===v&&n.isDirty===M&&j(o,u))return n;let P={...u,errorMap:T,fieldMeta:this.fieldMetaDerived.state,errors:p,isFieldsValidating:c,isFieldsValid:l,isFormValid:w,isValid:E,canSubmit:A,isTouched:f,isBlurred:m,isPristine:F,isDefaultValue:v,isDirty:M};const X=((oe=this.options.transform)==null?void 0:oe.deps)??[];if(X.length!==this.prevTransformArray.length||X.some((V,x)=>V!==this.prevTransformArray[x])){const V=Object.assign({},this,{state:P});(le=this.options.transform)==null||le.fn(V),P=V.state,this.prevTransformArray=X}return P}}),this.handleSubmit=this.handleSubmit.bind(this),this.update(a||{})}get state(){return this.store.state}get formId(){return this.options.formId}runValidator(a){return Me(a.validate)?B[a.type](a.value,a.validate):a.validate(a.value)}async handleSubmit(a){var t,s,n,o,u,d,h,c;if(this.baseStore.setState(l=>({...l,isSubmitted:!1,submissionAttempts:l.submissionAttempts+1,isSubmitSuccessful:!1})),k(()=>{Object.values(this.fieldInfo).forEach(l=>{l.instance&&(l.instance.state.meta.isTouched||l.instance.setMeta(f=>({...f,isTouched:!0})))})}),!this.state.canSubmit)return;const i=a??this.options.onSubmitMeta;this.baseStore.setState(l=>({...l,isSubmitting:!0}));const e=()=>{this.baseStore.setState(l=>({...l,isSubmitting:!1}))};if(await this.validateAllFields("submit"),!this.state.isFieldsValid){e(),(s=(t=this.options).onSubmitInvalid)==null||s.call(t,{value:this.state.values,formApi:this,meta:i});return}if(await this.validate("submit"),!this.state.isValid){e(),(o=(n=this.options).onSubmitInvalid)==null||o.call(n,{value:this.state.values,formApi:this,meta:i});return}k(()=>{Object.values(this.fieldInfo).forEach(l=>{var f,m,v;(v=(m=(f=l.instance)==null?void 0:f.options.listeners)==null?void 0:m.onSubmit)==null||v.call(m,{value:l.instance.state.value,fieldApi:l.instance})})}),(d=(u=this.options.listeners)==null?void 0:u.onSubmit)==null||d.call(u,{formApi:this,meta:i});try{await((c=(h=this.options).onSubmit)==null?void 0:c.call(h,{value:this.state.values,formApi:this,meta:i})),k(()=>{this.baseStore.setState(l=>({...l,isSubmitted:!0,isSubmitSuccessful:!0})),e()})}catch(l){throw this.baseStore.setState(f=>({...f,isSubmitSuccessful:!1})),e(),l}}setErrorMap(a){k(()=>{Object.entries(a).forEach(([i,e])=>{const t=i;if(ie(e)){const{formError:s,fieldErrors:n}=G(e);for(const o of Object.keys(this.fieldInfo))this.getFieldMeta(o)&&this.setFieldMeta(o,d=>({...d,errorMap:{...d.errorMap,[t]:n==null?void 0:n[o]},errorSourceMap:{...d.errorSourceMap,[t]:"form"}}));this.baseStore.setState(o=>({...o,errorMap:{...o.errorMap,[t]:s}}))}else this.baseStore.setState(s=>({...s,errorMap:{...s.errorMap,[t]:e}}))})})}}function G(r){if(r){if(ie(r)){const a=G(r.form).formError,i=r.fields;return{formError:a,fieldErrors:i}}return{formError:r}}return{formError:void 0}}function N(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class Ne{constructor(a){this.options={},this.mount=()=>{var s,n;const i=this.store.mount();this.options.defaultValue!==void 0&&this.form.setFieldValue(this.name,this.options.defaultValue,{dontUpdateMeta:!0});const e=this.getInfo();e.instance=this,this.update(this.options);const{onMount:t}=this.options.validators||{};if(t){const o=this.runValidator({validate:t,value:{value:this.state.value,fieldApi:this,validationSource:"field"},type:"validate"});o&&this.setMeta(u=>({...u,errorMap:{...u==null?void 0:u.errorMap,onMount:o},errorSourceMap:{...u==null?void 0:u.errorSourceMap,onMount:"field"}}))}return(n=(s=this.options.listeners)==null?void 0:s.onMount)==null||n.call(s,{value:this.state.value,fieldApi:this}),i},this.update=i=>{this.options=i;const e=this.name!==i.name;if(this.name=i.name,this.state.value===void 0){const t=O(i.form.options.defaultValues,i.name),s=i.defaultValue??t;e?this.setValue(n=>n||s,{dontUpdateMeta:!0}):s!==void 0&&this.setValue(s,{dontUpdateMeta:!0})}this.form.getFieldMeta(this.name)===void 0&&this.setMeta(this.state.meta)},this.getValue=()=>this.form.getFieldValue(this.name),this.setValue=(i,e)=>{this.form.setFieldValue(this.name,i,L(e,{dontRunListeners:!0,dontValidate:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener(),e!=null&&e.dontValidate||this.validate("change")},this.getMeta=()=>this.store.state.meta,this.setMeta=i=>this.form.setFieldMeta(this.name,i),this.getInfo=()=>this.form.getFieldInfo(this.name),this.pushValue=(i,e)=>{this.form.pushFieldValue(this.name,i,L(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.insertValue=(i,e,t)=>{this.form.insertFieldValue(this.name,i,e,L(t,{dontRunListeners:!0})),t!=null&&t.dontRunListeners||this.triggerOnChangeListener()},this.replaceValue=(i,e,t)=>{this.form.replaceFieldValue(this.name,i,e,L(t,{dontRunListeners:!0})),t!=null&&t.dontRunListeners||this.triggerOnChangeListener()},this.removeValue=(i,e)=>{this.form.removeFieldValue(this.name,i,L(e,{dontRunListeners:!0})),e!=null&&e.dontRunListeners||this.triggerOnChangeListener()},this.swapValues=(i,e,t)=>{this.form.swapFieldValues(this.name,i,e,L(t,{dontRunListeners:!0})),t!=null&&t.dontRunListeners||this.triggerOnChangeListener()},this.moveValue=(i,e,t)=>{this.form.moveFieldValues(this.name,i,e,L(t,{dontRunListeners:!0})),t!=null&&t.dontRunListeners||this.triggerOnChangeListener()},this.clearValues=i=>{this.form.clearFieldValues(this.name,L(i,{dontRunListeners:!0})),i!=null&&i.dontRunListeners||this.triggerOnChangeListener()},this.getLinkedFields=i=>{const e=Object.values(this.form.fieldInfo),t=[];for(const s of e){if(!s.instance)continue;const{onChangeListenTo:n,onBlurListenTo:o}=s.instance.options.validators||{};i==="change"&&(n!=null&&n.includes(this.name))&&t.push(s.instance),i==="blur"&&(o!=null&&o.includes(this.name))&&t.push(s.instance)}return t},this.validateSync=(i,e)=>{var d;const t=ee(i,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||D}),n=this.getLinkedFields(i).reduce((h,c)=>{const l=ee(i,{...c.options,form:c.form,validationLogic:c.form.options.validationLogic||D});return l.forEach(f=>{f.field=c}),h.concat(l)},[]);let o=!1;k(()=>{const h=(c,l)=>{var F;const f=z(l.cause),m=l.validate?fe(c.runValidator({validate:l.validate,value:{value:c.store.state.value,validationSource:"field",fieldApi:c},type:"validate"})):void 0,v=e[f],{newErrorValue:g,newSource:M}=ce({formLevelError:v,fieldLevelError:m});((F=c.state.meta.errorMap)==null?void 0:F[f])!==g&&c.setMeta(S=>({...S,errorMap:{...S.errorMap,[f]:g},errorSourceMap:{...S.errorSourceMap,[f]:M}})),g&&(o=!0)};for(const c of t)h(this,c);for(const c of n)c.validate&&h(c.field,c)});const u=z("submit");return(d=this.state.meta.errorMap)!=null&&d[u]&&i!=="submit"&&!o&&this.setMeta(h=>({...h,errorMap:{...h.errorMap,[u]:void 0},errorSourceMap:{...h.errorSourceMap,[u]:void 0}})),{hasErrored:o}},this.validateAsync=async(i,e)=>{const t=te(i,{...this.options,form:this.form,validationLogic:this.form.options.validationLogic||D}),s=await e,n=this.getLinkedFields(i),o=n.reduce((l,f)=>{const m=te(i,{...f.options,form:f.form,validationLogic:f.form.options.validationLogic||D});return m.forEach(v=>{v.field=f}),l.concat(m)},[]);this.state.meta.isValidating||this.setMeta(l=>({...l,isValidating:!0}));for(const l of n)l.setMeta(f=>({...f,isValidating:!0}));const u=[],d=[],h=(l,f,m)=>{const v=z(f.cause),g=l.getInfo().validationMetaMap[v];g==null||g.lastAbortController.abort();const M=new AbortController;this.getInfo().validationMetaMap[v]={lastAbortController:M},m.push(new Promise(async F=>{var I;let S;try{S=await new Promise((A,T)=>{this.timeoutIds.validations[f.cause]&&clearTimeout(this.timeoutIds.validations[f.cause]),this.timeoutIds.validations[f.cause]=setTimeout(async()=>{if(M.signal.aborted)return A(void 0);try{A(await this.runValidator({validate:f.validate,value:{value:l.store.state.value,fieldApi:l,signal:M.signal,validationSource:"field"},type:"validateAsync"}))}catch(P){T(P)}},f.debounceMs)})}catch(A){S=A}if(M.signal.aborted)return F(void 0);const b=fe(S),p=(I=s[this.name])==null?void 0:I[v],{newErrorValue:w,newSource:E}=ce({formLevelError:p,fieldLevelError:b});l.setMeta(A=>({...A,errorMap:{...A==null?void 0:A.errorMap,[v]:w},errorSourceMap:{...A.errorSourceMap,[v]:E}})),F(w)}))};for(const l of t)l.validate&&h(this,l,u);for(const l of o)l.validate&&h(l.field,l,d);let c=[];(u.length||d.length)&&(c=await Promise.all(u),await Promise.all(d)),this.setMeta(l=>({...l,isValidating:!1}));for(const l of n)l.setMeta(f=>({...f,isValidating:!1}));return c.filter(Boolean)},this.validate=(i,e)=>{var o;if(!this.state.meta.isTouched)return[];const{fieldsErrorMap:t}=e!=null&&e.skipFormValidation?{fieldsErrorMap:{}}:this.form.validateSync(i),{hasErrored:s}=this.validateSync(i,t[this.name]??{});if(s&&!this.options.asyncAlways)return(o=this.getInfo().validationMetaMap[z(i)])==null||o.lastAbortController.abort(),this.state.meta.errors;const n=e!=null&&e.skipFormValidation?Promise.resolve({}):this.form.validateAsync(i);return this.validateAsync(i,n)},this.handleChange=i=>{this.setValue(i)},this.handleBlur=()=>{this.state.meta.isTouched||this.setMeta(e=>({...e,isTouched:!0})),this.state.meta.isBlurred||this.setMeta(e=>({...e,isBlurred:!0})),this.validate("blur"),this.triggerOnBlurListener()},this.parseValueWithSchema=i=>B.validate({value:this.state.value,validationSource:"field"},i),this.parseValueWithSchemaAsync=i=>B.validateAsync({value:this.state.value,validationSource:"field"},i),this.form=a.form,this.name=a.name,this.timeoutIds={validations:{},listeners:{},formListeners:{}},this.store=new H({deps:[this.form.store],fn:()=>{const i=this.form.getFieldValue(this.name),e=this.form.getFieldMeta(this.name)??{...q,...a.defaultMeta};return{value:i,meta:e}}}),this.options=a}get state(){return this.store.state}runValidator(a){return Me(a.validate)?B[a.type](a.value,a.validate):a.validate(a.value)}setErrorMap(a){this.setMeta(i=>({...i,errorMap:{...i.errorMap,...a}}))}triggerOnBlurListener(){var e,t,s,n,o,u;const a=(e=this.form.options.listeners)==null?void 0:e.onBlurDebounceMs;a&&a>0?(this.timeoutIds.formListeners.blur&&clearTimeout(this.timeoutIds.formListeners.blur),this.timeoutIds.formListeners.blur=setTimeout(()=>{var d,h;(h=(d=this.form.options.listeners)==null?void 0:d.onBlur)==null||h.call(d,{formApi:this.form,fieldApi:this})},a)):(s=(t=this.form.options.listeners)==null?void 0:t.onBlur)==null||s.call(t,{formApi:this.form,fieldApi:this});const i=(n=this.options.listeners)==null?void 0:n.onBlurDebounceMs;i&&i>0?(this.timeoutIds.listeners.blur&&clearTimeout(this.timeoutIds.listeners.blur),this.timeoutIds.listeners.blur=setTimeout(()=>{var d,h;(h=(d=this.options.listeners)==null?void 0:d.onBlur)==null||h.call(d,{value:this.state.value,fieldApi:this})},i)):(u=(o=this.options.listeners)==null?void 0:o.onBlur)==null||u.call(o,{value:this.state.value,fieldApi:this})}triggerOnChangeListener(){var e,t,s,n,o,u;const a=(e=this.form.options.listeners)==null?void 0:e.onChangeDebounceMs;a&&a>0?(this.timeoutIds.formListeners.change&&clearTimeout(this.timeoutIds.formListeners.change),this.timeoutIds.formListeners.change=setTimeout(()=>{var d,h;(h=(d=this.form.options.listeners)==null?void 0:d.onChange)==null||h.call(d,{formApi:this.form,fieldApi:this})},a)):(s=(t=this.form.options.listeners)==null?void 0:t.onChange)==null||s.call(t,{formApi:this.form,fieldApi:this});const i=(n=this.options.listeners)==null?void 0:n.onChangeDebounceMs;i&&i>0?(this.timeoutIds.listeners.change&&clearTimeout(this.timeoutIds.listeners.change),this.timeoutIds.listeners.change=setTimeout(()=>{var d,h;(h=(d=this.options.listeners)==null?void 0:d.onChange)==null||h.call(d,{value:this.state.value,fieldApi:this})},i)):(u=(o=this.options.listeners)==null?void 0:o.onChange)==null||u.call(o,{value:this.state.value,fieldApi:this})}}function fe(r){if(r)return r}function z(r){switch(r){case"submit":return"onSubmit";case"blur":return"onBlur";case"mount":return"onMount";case"server":return"onServer";case"dynamic":return"onDynamic";case"change":default:return"onChange"}}class J{constructor(a){if(this.getFormFieldName=i=>{if(typeof this.fieldsMap=="string")return ue(this.fieldsMap,i);const e=Q(i)[0];if(typeof e!="string")return"";const t=i.slice(e.length),s=this.fieldsMap[e];return ue(s,t)},this.mount=()=>this.store.mount(),this.validateArrayFieldsStartingFrom=async(i,e,t)=>this.form.validateArrayFieldsStartingFrom(this.getFormFieldName(i),e,t),this.validateField=(i,e)=>this.form.validateField(this.getFormFieldName(i),e),this.getFieldValue=i=>this.form.getFieldValue(this.getFormFieldName(i)),this.getFieldMeta=i=>this.form.getFieldMeta(this.getFormFieldName(i)),this.setFieldMeta=(i,e)=>this.form.setFieldMeta(this.getFormFieldName(i),e),this.setFieldValue=(i,e,t)=>this.form.setFieldValue(this.getFormFieldName(i),e,t),this.deleteField=i=>this.form.deleteField(this.getFormFieldName(i)),this.pushFieldValue=(i,e,t)=>this.form.pushFieldValue(this.getFormFieldName(i),e,t),this.insertFieldValue=async(i,e,t,s)=>this.form.insertFieldValue(this.getFormFieldName(i),e,t,s),this.replaceFieldValue=async(i,e,t,s)=>this.form.replaceFieldValue(this.getFormFieldName(i),e,t,s),this.removeFieldValue=async(i,e,t)=>this.form.removeFieldValue(this.getFormFieldName(i),e,t),this.swapFieldValues=(i,e,t,s)=>this.form.swapFieldValues(this.getFormFieldName(i),e,t,s),this.moveFieldValues=(i,e,t,s)=>this.form.moveFieldValues(this.getFormFieldName(i),e,t,s),this.clearFieldValues=(i,e)=>this.form.clearFieldValues(this.getFormFieldName(i),e),this.resetField=i=>this.form.resetField(this.getFormFieldName(i)),this.validateAllFields=i=>this.form.validateAllFields(i),a.form instanceof J){const i=a.form;if(this.form=i.form,typeof a.fields=="string")this.fieldsMap=i.getFormFieldName(a.fields);else{const e={...a.fields};for(const t in e)e[t]=i.getFormFieldName(e[t]);this.fieldsMap=e}}else this.form=a.form,this.fieldsMap=a.fields;this.store=new H({deps:[this.form.store],fn:({currDepVals:i})=>{const e=i[0];let t;if(typeof this.fieldsMap=="string")t=O(e.values,this.fieldsMap);else{t={};const s=this.fieldsMap;for(const n in s)t[n]=O(e.values,s[n])}return{values:t}}})}get state(){return this.store.state}async handleSubmit(a){return this.form.handleSubmit(a)}}const R=typeof window<"u"?C.useLayoutEffect:C.useEffect;function Re(r){const[a]=C.useState(()=>{const e=new Ne({...r,form:r.form,name:r.name});return e.Field=Fe,e});return R(a.mount,[a]),R(()=>{a.update(r)}),$(a.store,r.mode==="array"?i=>[i.meta,Object.keys(i.value??[]).length]:void 0),a}const Fe=(({children:r,...a})=>{const i=Re(a),e=C.useMemo(()=>W(r,i),[r,i,i.state.value,i.state.meta]);return y.jsx(y.Fragment,{children:e})});function We({form:r,selector:a,children:i}){const e=$(r.store,a);return W(i,e)}function _e(r){const[a]=C.useState(()=>{const i=new Pe(r),e=i;return e.Field=function(s){return y.jsx(Fe,{...s,form:i})},e.Subscribe=function(s){return y.jsx(We,{form:i,selector:s.selector,children:s.children})},e});return R(a.mount,[]),R(()=>{a.update(r)}),a}function Ke({lens:r,selector:a,children:i}){const e=$(r.store,a);return W(i,e)}function Ue(r){const[a]=C.useState(()=>{const i=new J(r),e=r.form instanceof J?r.form.form:r.form,t=i;return t.AppForm=function(n){return y.jsx(e.AppForm,{...n})},t.AppField=function({name:n,...o}){return y.jsx(e.AppField,{name:a.getFormFieldName(n),...o})},t.Field=function({name:n,...o}){return y.jsx(e.Field,{name:a.getFormFieldName(n),...o})},t.Subscribe=function(n){return y.jsx(Ke,{lens:a,selector:n.selector,children:n.children})},Object.assign(t,{...r.formComponents})});return R(a.mount,[a]),a}const me=C.createContext(null),ve=C.createContext(null);function ze(){function r(){const i=C.useContext(me);if(!i)throw new Error("`fieldContext` only works when within a `fieldComponent` passed to `createFormHook`");return i}function a(){const i=C.useContext(ve);if(!i)throw new Error("`formContext` only works when within a `formComponent` passed to `createFormHook`");return i}return{fieldContext:me,useFieldContext:r,useFormContext:a,formContext:ve}}function Ge({fieldComponents:r,fieldContext:a,formContext:i,formComponents:e}){function t(o){const u=_e(o),d=C.useMemo(()=>(({children:f})=>y.jsx(i.Provider,{value:u,children:f})),[u]),h=C.useMemo(()=>(({children:f,...m})=>y.jsx(u.Field,{...m,children:v=>y.jsx(a.Provider,{value:v,children:f(Object.assign(v,r))})})),[u]);return C.useMemo(()=>Object.assign(u,{AppField:h,AppForm:d,...e}),[u,h,d])}function s({render:o,props:u}){return d=>o({...u,...d})}function n({render:o,props:u,defaultValues:d}){return function(c){const l=C.useMemo(()=>({form:c.form,fields:c.fields,defaultValues:d,formComponents:e}),[c.form,c.fields]),f=Ue(l);return o({...u,...c,group:f})}}return{useAppForm:t,withForm:s,withFieldGroup:n}}const{fieldContext:He,useFieldContext:se,formContext:qe,useFormContext:Je}=ze();function Qe({label:r}){const a=Je();return y.jsx(a.Subscribe,{selector:i=>i.isSubmitting,children:i=>y.jsx(Ve,{type:"submit",disabled:i,children:r})})}function re({errors:r}){return y.jsx(y.Fragment,{children:r.map(a=>y.jsx("div",{className:"text-red-500 mt-1 font-bold",children:typeof a=="string"?a:a.message},typeof a=="string"?a:a.message))})}function Xe({label:r,placeholder:a}){const i=se(),e=$(i.store,t=>t.meta.errors);return y.jsxs("div",{children:[y.jsx(ge,{htmlFor:r,className:"mb-2 text-xl font-bold",children:r}),y.jsx(Se,{value:i.state.value,placeholder:a,onBlur:i.handleBlur,onChange:t=>i.handleChange(t.target.value)}),i.state.meta.isTouched&&y.jsx(re,{errors:e})]})}function Ye({label:r,rows:a=3}){const i=se(),e=$(i.store,t=>t.meta.errors);return y.jsxs("div",{children:[y.jsx(ge,{htmlFor:r,className:"mb-2 text-xl font-bold",children:r}),y.jsx(be,{id:r,value:i.state.value,onBlur:i.handleBlur,rows:a,onChange:t=>i.handleChange(t.target.value)}),i.state.meta.isTouched&&y.jsx(re,{errors:e})]})}function Ze({label:r,values:a,placeholder:i}){const e=se(),t=$(e.store,s=>s.meta.errors);return y.jsxs("div",{children:[y.jsxs(pe,{name:e.name,value:e.state.value,onValueChange:s=>e.handleChange(s),children:[y.jsx(Ae,{className:"w-full",children:y.jsx(we,{placeholder:i})}),y.jsx(Ee,{children:y.jsxs(Le,{children:[y.jsx(Ce,{children:r}),a.map(s=>y.jsx(Ie,{value:s.value,children:s.label},s.value))]})})]}),e.state.meta.isTouched&&y.jsx(re,{errors:t})]})}const{useAppForm:at}=Ge({fieldComponents:{TextField:Xe,Select:Ze,TextArea:Ye},formComponents:{SubscribeButton:Qe},fieldContext:He,formContext:qe});export{at as u};
