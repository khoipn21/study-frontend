import{Y as h,u as b,d as j,j as e}from"./main-amE6mPDm.js";import{u as d}from"./useQuery-DdeLzvk4.js";import{u as N}from"./useMutation-BBcAv7H8.js";import{a as o}from"./api-client-CoYXQ-f4.js";function T(){var n,i,c,u;const{topicId:s}=h.useParams(),{token:l,user:m}=b(),p=j(),r=d({queryKey:["forum","topic",s],queryFn:async()=>await o.getTopic(s)}),x=d({queryKey:["forum","topic",s,"posts"],queryFn:async()=>await o.listTopicPosts(s,{page:1,limit:50})}),a=N({mutationFn:async t=>o.createPost(l||"",{topic_id:s,content:t}),onSuccess:()=>p.invalidateQueries({queryKey:["forum","topic",s,"posts"]})}),y=t=>{t.preventDefault();const g=new FormData(t.currentTarget),f=String(g.get("content")||"");a.mutate(f),t.currentTarget.reset()};return e.jsxs("div",{className:"p-4 max-w-3xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:((n=r.data)==null?void 0:n.title)??"Topic"}),e.jsx("p",{className:"text-gray-700 mb-4",children:(i=r.data)==null?void 0:i.description}),e.jsx("ul",{className:"divide-y bg-white border rounded",children:(u=(c=x.data)==null?void 0:c.posts)==null?void 0:u.map(t=>e.jsxs("li",{className:"p-3",children:[e.jsx("div",{className:"text-sm",children:t.content}),e.jsxs("div",{className:"text-xs text-gray-500",children:["by ",t.user_id," at ",new Date(t.created_at).toLocaleString()]})]},t.id))}),m&&e.jsxs("form",{onSubmit:y,className:"mt-4 flex flex-col gap-2",children:[e.jsx("textarea",{name:"content",placeholder:"Write a reply...",className:"border p-2 rounded",required:!0}),e.jsx("button",{className:"px-3 py-2 bg-blue-600 text-white rounded self-start",disabled:a.isPending,children:a.isPending?"Posting...":"Post"})]})]})}export{T as component};
